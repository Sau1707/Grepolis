// ==UserScript==
// @name         GrepoTweaks-Merged
// @namespace    grepotweaksmerged
// @author       Sau1707
// @description  All the GrepoTweaks merged in a single script
// @version      1.2.1
// @match        http://*.grepolis.com/game/*
// @match        https://*.grepolis.com/game/*
// @match        https://sau1707.github.io/Grepolis/
// @require      https://github.com/Sau1707/Grepolis/raw/main/update.js
// ==/UserScript==


!function(){"use strict";const n=unsafeWindow||window;let o;function t(){var t=document.getElementsByClassName("order_max button_new")[0],e=document.getElementsByClassName("order_confirm button_new square")[0];null!=t&&null!=e||clearInterval(o),5e3<n.ITowns.towns[n.Game.townId].resources().iron&&(t.click(),e.click())}function i(){var t=document.getElementsByClassName("order_count")[0],e=document.createElement("div");e.className="button_new",e.id="autoCaveButton",e.style="float: right; margin: 0px; left: 169px; position: absolute; top: 56px; width: 66px",e.innerHTML='<div class="left"></div><div class="right"></div><div class="caption js-caption"> Auto <div class="effect js-effect"></div></div>',t.insertBefore(e,t.childNodes[0])}function s(){n.$("#autoCaveButton").click(()=>{o=o?(n.$("#autoCaveButton").css("filter",""),clearInterval(o),null):(n.$("#autoCaveButton").css("filter","brightness(100%) sepia(100%) hue-rotate(90deg) saturate(1500%) contrast(0.8)"),setInterval(t,1e3))})}n.$.Observer(n.GameEvents.town.town_switch).subscribe((t,e)=>{setTimeout(()=>{document.getElementById("autoCaveButton")||document.getElementsByClassName("js-window-main-container classic_window hide")[0]&&(i(),s(),setTimeout(()=>document.getElementsByClassName("order_max button_new")[0].click(),500))},100)}),n.$.Observer(n.GameEvents.window.open).subscribe((t,e)=>{e.attributes&&"hide"==e.attributes.window_type&&setTimeout(()=>{i(),s(),setTimeout(()=>document.getElementsByClassName("order_max button_new")[0].click(),500)},200)}),console.log("[GrepoTweaks-AutoCave] Loaded")}(),function(){"use strict";const a=unsafeWindow||window;function r(t){var e=3<(e=a.ITowns.getCurrentTown().getLandUnits()).sword?"sword":3<e.archer?"archer":3<e.hoplite?"hoplite":null;e?((t={id:t=t.id,type:"support"})[e]=3,a.gpAjax.ajaxPost("town_info","send_units",t)):a.HumanMessage.error("No troops available")}a.$.Observer(a.GameEvents.map.town.click).subscribe((t,e)=>{var n,o,i,s;if((n=e.x,o=e.y,s=(i=a.ITowns.getCurrentTown()).getIslandCoordinateX(),i=i.getIslandCoordinateY(),s==n&&i==o)&&(!function(t){var e,n;for(e of Object.keys(a.ITowns.towns)){if(e==t)return 1;for(n of a.ITowns.all_supporting_units.fragments[e].models)if(n.attributes.current_town_id==t)return 1}}(e.id)&&!function(t){var e,n=a.MM.getModels().MovementsUnits;for(e in n)if(n[e].attributes.target_town_id==t)return 1}(e.id))){let t=a.$("#context_menu");t&&((s=document.createElement("div")).id="sentinel_button",s.style.width="50px",s.style.height="50px",s.style.position="absolute",s.style.background="url(https://i.ibb.co/9wwBNfD/sentinel.png)",s.style.zIndex="auto",s.style.cursor="pointer",s.innerHTML=`        <div id="sentinel_description" style="position: absolute;overflow: hidden;width: 118px;display: none;margin-left: -59px;left: 50%;top: 40px;z-index: 5;" >        <div style="position: absolute; top: 0; left: 0; right: 0; background: url(https://gpit.innogamescdn.com/images/game/autogenerated/layout/layout_095495a.png) no-repeat -488px -406px; width: 118px; height: 18px;"></div>        <div style="position: absolute; top: 18px; left: 0; right: 0; bottom: 11px; background: url(https://gpit.innogamescdn.com/images/game/layout/context_menu_middle.png) repeat-y 0 0;"></div>        <div style="position: absolute; bottom: 0; left: 0; right: 0; background: url(https://gpit.innogamescdn.com/images/game/autogenerated/layout/layout_095495a.png) no-repeat -326px -240px; width: 118px; height: 11px;"></div>        <div style="color: #fc6; font-weight: 700; text-align: center; word-wrap: break-word; line-height: 19px; z-index: 1; position: relative; padding: 4px;">Sentinel</div>        </div>`,t.append(s),a.$("#sentinel_button").animate({top:"-100px"},120),a.$("#sentinel_button").hover(()=>{a.$("#sentinel_description").css("display","block")},()=>{a.$("#sentinel_description").css("display","none")}),a.$("#sentinel_button").click(()=>{r(e),t.remove()}))}})}();